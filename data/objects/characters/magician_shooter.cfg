# magician_shooter.cfg
# One of Smoke's mirrors; shoots at player
#
# Notes: With the current, 10x10 hurtbox, there are 10 units from
# one edge of a wall to another in the x and y directions.
# (If the walls have a single tile between them.)

{

#DEFINES#
id: "magician_shooter",
prototype: ["hittable"],
editor_info: { category: "Characters" },
solid_dimensions: ["player","common","boss"],
collide_dimensions: ["common","energy","boss"],
vehicle: false,
has_feet: false,
feet_width: null,
hitpoints: 10,
max_hitpoints: 10,
mass: 5,
friction: 22000,

zorder: "@include data/zorder.cfg:player",

properties: {
	walkspeed: 888,
	movespeed: "walkspeed",
	//movespeed: 3,
	
	flinch_threshold: 0,
	hurt_velocity_y: "0",
	hurt_velocity_x: "0",
	
	# -- AI/player interactions -- #
	is_player_behind: "bool :: if(
		facing_down, me.midpoint_y-level.player.midpoint_y > 0,
		facing_up, me.midpoint_y-level.player.midpoint_y < 0,
		facing_right, me.midpoint_x-level.player.midpoint_x > 0,
		facing_left, me.midpoint_x-level.player.midpoint_x < 0,
		false)", // Default if none of the others
	is_vision_obstructed: "bool(solid(level, midpoint_x,midpoint_y,level.player.midpoint_x-midpoint_x,level.player.midpoint_y-midpoint_y))",
	is_player_visible: "not is_vision_obstructed and not is_player_behind",
},	#### EVENTS START HERE ####

on_create: "[animation('look_down'),
			set(facing, 1),	// No flipping! Must always face the same direction
			align_self]",
on_end_look_down_anim: "animation('look_down')",

# -- Animations Logic -- #
on_process: "[if(is_standing, add(y,-1)), // This is a work around for a glitch
	/*if(is_aligned and midpoint_xy != old_midpoint_xy, [
		set(old_midpoint_xy, midpoint_xy),
		if(is_player_visible,
			beginattack,
			if(on_lens, track_player, chose_dir)
			)
		], null) // We should be walking via animation*/
	]",

on_end_walk_up_anim: "animation('walk_up')",

on_end_walk_down_anim: "animation('walk_down')",

on_end_walk_right_anim: "animation('walk_right')",

on_end_walk_left_anim: "animation('walk_left')",

/*on_process_run: "if(not (ctrl_left or ctrl_right),
					animation('stand'))",

on_end_hurt_anim: "animation('stand')",*/

on_cast_fire1: "[
	if(
		facing_down, animation('cast_down'),
		facing_up, animation('cast_up'),
		facing_right, animation('cast_right'),
		facing_left, animation('cast_left')),
	spawn('magician_shooter.firebolt', midpoint_x, midpoint_y, facing,
		[set(child.velocity_x, launch_x(750)),
		set(child.velocity_y, launch_y(750))])]",

on_end_cast_down_anim: "animation('look_down')",
on_end_cast_up_anim: "animation('look_up')",
on_end_cast_right_anim: "animation('look_right')",
on_end_cast_left_anim: "animation('look_left')",

# -- Info and Time Attack -- #
/*on_ctrl_jump: "if(cycle_of_last_up + 20 < cycle,
			set(cycle_of_last_up, cycle),*/
			
#ANIMATIONS#
animation: [

	# -- Walking and Looking -- #
	{
		id: "look_down",
		body_area: "all",
		image: "characters/magician_purple.png",
		rect: [90, 3, 115, 27],
		solid_area: [7,14,17,24],
		frames: 1,
		frames_per_row: 8,
		pad: 3,
		duration: 6,
	},

	{
		id: "look_up",
		body_area: "all",
		image: "characters/magician_purple.png",
		rect: [208, 3, 233, 28],
		solid_area: [7,14,17,24],
		frames: 1,
		pad: 3,
		frames_per_row: 4,
		duration: 8,
	},
	
	{
		id: "look_right",
		body_area: "all",
		image: "characters/magician_purple.png",
		rect: [90, 34, 115, 59],
		solid_area: [6,14,16,24],
		frames: 1,
		pad: 3,
		frames_per_row: 4,
		duration: 8,
	},

	{
		id: "look_left",
		body_area: "all",
		image: "characters/magician_purple.png",
		rect: [150, 34, 175, 59],
		solid_area: [9,14,19,24],
		frames: 1,
		pad: 3,
		frames_per_row: 4,
		duration: 8,
	},
	
	{
		id: "walk_down",
		body_area: "all",
		image: "characters/magician_purple.png",
		rect: [3, 3, 28, 28],
		solid_area: [7,14,17,24],
		frames: 4,
		pad: 3,
		frames_per_row: 4,
		duration: 9,
	},
	
	{
		id: "walk_up",
		body_area: "all",
		image: "characters/magician_purple.png",
		rect: [121, 3, 146, 28],
		solid_area: [7,14,17,24],
		frames: 4,
		pad: 3,
		frames_per_row: 4,
		duration: 9,
	},

	{
		id: "walk_right",
		body_area: "all",
		image: "characters/magician_purple.png",
		rect: [3, 34, 28, 59],
		solid_area: [6,14,16,24],
		frames: 4,
		pad: 3,
		frames_per_row: 4,
		duration: 9,
	},
	
	{
		id: "walk_left",
		body_area: "all",
		image: "characters/magician_purple.png",
		rect: [121, 34, 146, 59],
		solid_area: [9,14,19,24],
		frames: 4,
		pad: 3,
		frames_per_row: 4,
		duration: 9,
	},

	# -- Magic Weilding -- #			
	{
		id: "cast_down",
		body_area: "all",
		image: "characters/magician_purple.png",
		rect: [61, 65, 86, 90],
		solid_area: [7,14,17,24],
		frames: 1,
		pad: 3,
		frames_per_row: 3,
		duration: 12,
	},
	
	{
		id: "cast_up",
		body_area: "all",
		image: "characters/magician_purple.png",
		rect: [150, 65, 175, 90],
		solid_area: [7,14,17,24],
		frames: 1,
		pad: 3,
		frames_per_row: 3,
		duration: 12,
	},
	
	{
		id: "cast_right",
		body_area: "all",
		image: "characters/magician_purple.png",
		rect: [61, 94, 86, 119],
		solid_area: [6,14,16,24],
		frames: 1,
		pad: 3,
		frames_per_row: 3,
		duration: 12,
	},
	
	{
		id: "cast_left",
		body_area: "all",
		image: "characters/magician_purple.png",
		rect: [150, 94, 175, 119],
		solid_area: [9,14,19,24],
		frames: 1,
		pad: 3,
		frames_per_row: 3,
		duration: 12,
	},
],

object_type: [
	{
	id: "firebolt",
	dies_on_inactive: true,
	timer_frequency: 450,
	object_level_collisions: true,
	solid_dimensions: ["player"],
	prototype: ["shot"],
	properties: {
	        attack_damage: "2",
	        team: "'evil'",
	},

	on_end_normal_anim: "animation('normal')",
	on_process: "if((time_in_animation%7) = 0, spawn('mage_playable.firebolt_trail',midpoint_x,midpoint_y,{velocity_x:0,velocity_y:0}))",
	on_end_flash_anim: "die()",
	on_timer: "die()",

	animation:
		{
		id: "normal",
		image: "effects/magic_fire.png",
		attack_area: [0,0,11,11],
		pad: 3,
		rect: [2,2,10,10],
		frames: 4,
		frames_per_row: 4,
		duration: 5
	    },
	},


	{
	id: "firebolt_trail",
	ignore_collide: true,
	on_end_normal_anim: "die()",
    
	zorder: 50,
	dies_on_inactive: true,
	on_spawned: "animation('normal')",

	animation:
	    {
		id: "normal",
		image: "effects/magic_fire.png",
		pad: 3,
		rect: [2, 14, 6, 18],
		frames: 4,
		frames_per_row: 5,
		duration: 4,
		x_accel: 0,
		y_accel: 0
	    },
	}
],

}
